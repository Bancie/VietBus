@startuml
left to right direction

title Hệ thống quản lý đưa đón học sinh - Sơ đồ use case toàn hệ thống

' ==== Actors ====
actor "Phụ huynh" as PH
actor "Học sinh" as HS
actor "Tài xế" as TX
actor "Nhà trường\n(Điều hành)" as NT
actor "Quản trị hệ thống" as AD
actor "Cổng thanh toán" as PSP
actor "Dịch vụ SMS/Push" as PUSH
actor "Dịch vụ Bản đồ/GPS" as GPS

' ==== System Boundary ====
rectangle "Hệ thống quản lý đưa đón" as SYS {
  ' Nhóm: Truy cập chung
  usecase "Đăng ký / Đăng nhập" as UC_AUTH
  usecase "Quên mật khẩu" as UC_FORGOT
  usecase "Quản lý hồ sơ cá nhân" as UC_PROFILE

  ' Nhóm: Phụ huynh
  usecase "Đăng ký tuyến / điểm đón" as UC_ENROLL
  usecase "Theo dõi vị trí xe\n(thời gian thực)" as UC_TRACK
  usecase "Nhận thông báo\n(lên/xuống xe, trễ giờ...)" as UC_NOTIFY
  usecase "Thanh toán phí dịch vụ" as UC_PAY
  usecase "Gửi phản hồi / khiếu nại" as UC_FEEDBACK

  ' Nhóm: Học sinh
  usecase "Xác nhận lên/xuống xe\n(qua thẻ/QR)" as UC_CHECKIN

  ' Nhóm: Tài xế
  usecase "Nhận phân công chuyến" as UC_ASSIGN
  usecase "Điều hướng lộ trình" as UC_NAV
  usecase "Báo sự cố / trễ chuyến" as UC_INCIDENT
  usecase "Điểm danh học sinh" as UC_ROSTER

  ' Nhóm: Nhà trường (Điều hành)
  usecase "Lập kế hoạch tuyến/chuyến" as UC_PLAN
  usecase "Phân công tài xế/xe" as UC_DISPATCH
  usecase "Giám sát chuyến đi" as UC_MONITOR
  usecase "Xử lý khiếu nại" as UC_HANDLE_FB
  usecase "Báo cáo & thống kê" as UC_REPORT

  ' Nhóm: Quản trị
  usecase "Quản lý người dùng/role" as UC_USER_MGMT
  usecase "Cấu hình hệ thống" as UC_CONFIG
  usecase "Quản lý phương tiện/thiết bị" as UC_FLEET

  ' Use case kỹ thuật (được include)
  usecase "Xử lý giao dịch" as UC_PSP_IMPL <<include>>
  usecase "Gửi SMS/Push" as UC_PUSH_IMPL <<include>>
  usecase "Định vị & bản đồ" as UC_GPS_IMPL <<include>>
}

' ==== Associations: Actors <-> Use cases ====
PH --> UC_AUTH
PH --> UC_PROFILE
PH --> UC_ENROLL
PH --> UC_TRACK
PH --> UC_NOTIFY
PH --> UC_PAY
PH --> UC_FEEDBACK

HS --> UC_CHECKIN
HS --> UC_NOTIFY

TX --> UC_AUTH
TX --> UC_ASSIGN
TX --> UC_NAV
TX --> UC_INCIDENT
TX --> UC_ROSTER

NT --> UC_PLAN
NT --> UC_DISPATCH
NT --> UC_MONITOR
NT --> UC_HANDLE_FB
NT --> UC_REPORT

AD --> UC_USER_MGMT
AD --> UC_CONFIG
AD --> UC_FLEET

' ==== Includes tới dịch vụ kỹ thuật ====
UC_PAY -right-> UC_PSP_IMPL : <<include>>
UC_NOTIFY -right-> UC_PUSH_IMPL : <<include>>
UC_TRACK -down-> UC_GPS_IMPL : <<include>>
UC_NAV -down-> UC_GPS_IMPL : <<include>>
UC_MONITOR -down-> UC_GPS_IMPL : <<include>>

' ==== Bi-directional/external systems ====
PSP .. UC_PSP_IMPL
PUSH .. UC_PUSH_IMPL
GPS .. UC_GPS_IMPL

' ==== Quan hệ hỗ trợ giữa các UC ====
UC_DISPATCH --> UC_ASSIGN
UC_PLAN --> UC_DISPATCH
UC_ROSTER --> UC_MONITOR
UC_INCIDENT --> UC_MONITOR
UC_HANDLE_FB --> UC_FEEDBACK

' ==== Một số extend tuỳ chọn ====
usecase "Xác thực 2FA" as UC_2FA
UC_AUTH .u.> UC_2FA : <<extend>>\n(tuỳ chọn theo chính sách)

' ==== Ghi chú / Legend ====
legend right
= Nhóm đối tượng =
PH: Phụ huynh | HS: Học sinh | TX: Tài xế
NT: Nhà trường/Điều hành | AD: Quản trị

<<include>>: UC phụ trợ kỹ thuật luôn được gọi
<<extend>>: UC mở rộng, tuỳ chính sách
endlegend

@enduml