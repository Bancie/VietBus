@startuml
left to right direction
skinparam actorStyle awesome
skinparam usecase {
  BackgroundColor #FAFAFA
  BorderColor #777
  ArrowColor #555
}
title Module "Bus Schedule & Tracking" - Use Case Diagram (riêng)

' ==== Actors ====
actor "Phụ huynh" as PH
actor "Học sinh" as HS
actor "Tài xế" as TX
actor "Điều hành\n(Nhà trường)" as NT
actor "Quản trị hệ thống" as AD
actor "Dịch vụ Bản đồ/GPS" as GPS
actor "Dịch vụ\nSMS/Push" as PUSH

' ==== System Boundary: MODULE ====
rectangle "Bus Schedule & Tracking" as MOD {
  ' --- Lõi lịch & theo dõi ---
  usecase "Quản lý lịch tuyến/chuyến" as UC_SCHED
  usecase "Gán xe/tài xế cho chuyến" as UC_ASSIGN
  usecase "Theo dõi vị trí xe\n(real-time)" as UC_TRACK
  usecase "Tính ETA & hiển thị\nđiểm dừng kế tiếp" as UC_ETA
  usecase "Giám sát & bảng điều khiển\n(fleet dashboard)" as UC_MONITOR
  usecase "Phát hiện lệch tuyến / geofence" as UC_GEOF
  usecase "Ghi nhận & phát lại lộ trình\n(trip replay)" as UC_REPLAY

  ' --- Tác vụ tác nghiệp từ ứng dụng ---
  usecase "Điểm danh lên/xuống\n(Quét thẻ/QR)" as UC_ROSTER
  usecase "Cập nhật trạng thái điểm dừng\n(đến/rời, trễ...)" as UC_STOP_STATUS
  usecase "Báo sự cố / trễ chuyến" as UC_INCIDENT

  ' --- Quan sát & cảnh báo người dùng ---
  usecase "Xem lịch xe & lộ trình" as UC_VIEW_SCHED
  usecase "Theo dõi xe con đang đi" as UC_FOLLOW
  usecase "Thiết lập cảnh báo\n(đến điểm đón, trễ...)" as UC_ALERT
  usecase "Nhận thông báo tự động" as UC_NOTIFY

  ' --- Use case kỹ thuật (include) ---
  usecase "Đồng bộ vị trí từ GPS" as UC_GPS_PULL <<include>>
  usecase "Tính toán ETA" as UC_ETA_CALC <<include>>
  usecase "Kiểm tra geofence" as UC_GEOF_CHECK <<include>>
  usecase "Gửi thông báo" as UC_PUSH_SEND <<include>>
}

' ==== Quan hệ nghiệp vụ ====
' Lịch & phân công
NT --> UC_SCHED
NT --> UC_ASSIGN
AD --> UC_SCHED
AD --> UC_ASSIGN

' Theo dõi & giám sát
NT --> UC_MONITOR
NT --> UC_REPLAY

' Tài xế vận hành
TX --> UC_STOP_STATUS
TX --> UC_INCIDENT
TX --> UC_ROSTER

' Học sinh
HS --> UC_ROSTER

' Phụ huynh quan sát
PH --> UC_VIEW_SCHED
PH --> UC_FOLLOW
PH --> UC_ALERT
PH --> UC_NOTIFY

' Theo dõi & ETA phụ thuộc kỹ thuật
UC_TRACK -down-> UC_GPS_PULL : <<include>>
UC_ETA -down-> UC_ETA_CALC : <<include>>
UC_GEOF -down-> UC_GEOF_CHECK : <<include>>
UC_NOTIFY -right-> UC_PUSH_SEND : <<include>>

' Chuỗi nghiệp vụ liên kết
UC_SCHED --> UC_ASSIGN
UC_ASSIGN --> UC_MONITOR
UC_STOP_STATUS --> UC_MONITOR
UC_INCIDENT --> UC_MONITOR
UC_TRACK --> UC_MONITOR
UC_ETA --> UC_FOLLOW
UC_GEOF --> UC_MONITOR

' Ngoại hệ thống
GPS .. UC_GPS_PULL
PUSH .. UC_PUSH_SEND

' ==== Các kịch bản mở rộng (extend) ====
usecase "Xử lý đường vòng / detour" as UC_DETOUR
usecase "Chế độ khẩn cấp" as UC_EMER
usecase "Thay tài xế/xe dự phòng" as UC_SUBS

UC_INCIDENT .u.> UC_EMER : <<extend>>
UC_GEOF .u.> UC_DETOUR : <<extend>>
UC_ASSIGN .u.> UC_SUBS : <<extend>>

' ==== Ghi chú ====
legend right
= Vai trò =
PH: Phụ huynh | HS: Học sinh | TX: Tài xế
NT: Điều hành/Nhà trường | AD: Quản trị

= Nhóm chức năng =
- Lịch & phân công
- Theo dõi/ETA/Geofence
- Tác nghiệp tại hiện trường
- Quan sát & cảnh báo

<<include>>: tự động được gọi trong luồng chính
<<extend>>: chỉ kích hoạt khi có điều kiện (sự cố, lệch tuyến...)
endlegend

@enduml